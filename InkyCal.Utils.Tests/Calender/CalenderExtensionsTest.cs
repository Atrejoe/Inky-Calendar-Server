using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Text;
using Ical.Net;
using InkyCal.Utils.Calendar;
using Xunit;

namespace InkyCal.Utils.Tests.Calender
{
	/// <summary>
	/// Tests <see cref="CalenderExtensions"/>
	/// </summary>
	public class CalenderExtensionsTest
	{
		//Demo calender
		internal const string demoCalender = @"BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:InkyCal-test-calendar
X-WR-TIMEZONE:Europe/Berlin
X-WR-CALDESC:This is a test calendar for the Inky-Calendar project on Githu
 b (copyright by aceisace). It is meant for debugging purposes.
BEGIN:VTIMEZONE
TZID:Europe/Berlin
X-LIC-LOCATION:Europe/Berlin
BEGIN:DAYLIGHT
TZOFFSETFROM:+0100
TZOFFSETTO:+0200
TZNAME:CEST
DTSTART:19700329T020000
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=-1SU
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETFROM:+0200
TZOFFSETTO:+0100
TZNAME:CET
DTSTART:19701025T030000
RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU
END:STANDARD
END:VTIMEZONE
BEGIN:VEVENT
DTSTART:20200527T150000Z
DTEND:20200527T200000Z
DTSTAMP:20201114T114528Z
UID:0rd0bnoklln3o344sogfft9fhc@google.com
CREATED:20200519T000009Z
DESCRIPTION:
LAST-MODIFIED:20200527T161913Z
LOCATION:
SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:27 May 5 pm - 10pm
TRANSP:OPAQUE
BEGIN:VALARM
ACTION:NONE
TRIGGER;VALUE=DATE-TIME:19760401T005545Z
END:VALARM
END:VEVENT
BEGIN:VEVENT
DTSTART;VALUE=DATE:20200523
DTEND;VALUE=DATE:20200525
DTSTAMP:20201114T114528Z
UID:1smg6ij14cubiq72j2m9htqdaf@google.com
CREATED:20200519T000035Z
DESCRIPTION:
LAST-MODIFIED:20200519T000035Z
LOCATION:
SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:23 May - 24 may
TRANSP:TRANSPARENT
END:VEVENT
BEGIN:VEVENT
DTSTART:20200521T160000Z
DTEND:20200521T170000Z
DTSTAMP:20201114T114528Z
UID:37s02v9ccq6kbnqas8jf8ths66@google.com
CREATED:20200518T235942Z
DESCRIPTION:
LAST-MODIFIED:20200518T235942Z
LOCATION:
SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:21 May 6pm-7pm
TRANSP:OPAQUE
END:VEVENT
BEGIN:VEVENT
DTSTART;VALUE=DATE:20200413
DTEND;VALUE=DATE:20200418
DTSTAMP:20201114T114528Z
UID:068CCF73-F3B0-4F84-85E0-7D336982E5FD
CREATED:20200304T055213Z
DESCRIPTION:
LAST-MODIFIED:20200304T055213Z
LOCATION:
SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:Multi-day-event 13apr-17apr
TRANSP:OPAQUE
BEGIN:VALARM
ACTION:NONE
TRIGGER;VALUE=DATE-TIME:19760401T005545Z
END:VALARM
END:VEVENT
BEGIN:VEVENT
DTSTART;TZID=Europe/Berlin:20200303T150000
DTEND;TZID=Europe/Berlin:20200303T160000
RRULE:FREQ=WEEKLY;UNTIL=20200703T215959Z
DTSTAMP:20201114T114528Z
UID:2C620ADD-0F4F-4B1F-9582-A2C42415101B
CREATED:20200303T143647Z
DESCRIPTION:This Event is a recurring event on Tuesdays at 3 pm (Europe/Ber
 lin) time and is shedules weekly until 3 July 2020
LAST-MODIFIED:20200303T143647Z
LOCATION:
SEQUENCE:0
STATUS:CONFIRMED
SUMMARY:Recurring event 1 hour
TRANSP:OPAQUE
BEGIN:VALARM
ACTION:NONE
TRIGGER;VALUE=DATE-TIME:19760401T005545Z
END:VALARM
END:VEVENT
END:VCALENDAR
";

		[Fact]
		public void TestCalender() {

			//arrange
			var calendars = new CalendarCollection();

			//act
			var actual = CalenderExtensions
							.LoadCalendar(demoCalender);
			calendars.Add(actual);

			actual = CalenderExtensions
							.LoadCalendar(demoCalender);

			calendars.Add(actual);

			//assert
			Assert.NotNull(calendars.GetOccurrences(DateTime.Now.Date));
		}

	}
}
